================================================================================
        HEALTHCARE GENAI CONTENT GENERATOR - LOW-LEVEL DESIGN (LLD)
================================================================================

                              Document Version: 1.0
                              Date: February 16, 2026
                              Project: Healthcare GenAI SaaS

================================================================================
                            TABLE OF CONTENTS
================================================================================

1. Requirements
   1.1 Functional Requirements
   1.2 Non-Functional Requirements
   
2. APIs
   2.1 REST API Endpoints
   2.2 Request/Response Schemas
   
3. Entities
   3.1 Core Entities
   3.2 Entity Relationships
   
4. Class Diagrams
   4.1 Backend Class Structure
   4.2 Class Relationships
   
5. Systematic Diagrams
   5.1 Sequence Diagrams
   5.2 System Flowcharts
   
6. Implementation Details
   6.1 Algorithms
   6.2 Data Structures
   6.3 Notable Modifications
   
7. Working Mechanism
   7.1 System Architecture
   7.2 Component Interactions
   7.3 RAG Pipeline Flow


================================================================================
                     VISUAL ARCHITECTURE DIAGRAMS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HIGH-LEVEL SYSTEM ARCHITECTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         PRESENTATION LAYER                            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                     React Frontend (Vite)                       â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
    â”‚  â”‚  â”‚ ContentForm  â”‚ â”‚DocumentLookupâ”‚ â”‚    OutputViewer          â”‚â”‚  â”‚
    â”‚  â”‚  â”‚  Component   â”‚ â”‚  Component   â”‚ â”‚    Component             â”‚â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
    â”‚  â”‚         â”‚                â”‚                                      â”‚  â”‚
    â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚  â”‚
    â”‚  â”‚                  â–¼                                              â”‚  â”‚
    â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚  â”‚
    â”‚  â”‚         â”‚  API Service   â”‚  (Axios HTTP Client)                 â”‚  â”‚
    â”‚  â”‚         â”‚   api.js       â”‚                                      â”‚  â”‚
    â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTP/REST (JSON)
                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         APPLICATION LAYER                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                  FastAPI Backend (main.py)                      â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚  â”‚                    API Endpoints                         â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  POST /api/generate    GET /api/document/{id}           â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  POST /api/patients    GET /api/patients/{hospital}     â”‚   â”‚  â”‚
    â”‚  â”‚  â”‚  GET /api/document-types                                â”‚   â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â”‚         â”‚                    â”‚                    â”‚             â”‚  â”‚
    â”‚  â”‚         â–¼                    â–¼                    â–¼             â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
    â”‚  â”‚  â”‚ RAGEngine  â”‚      â”‚PromptEngineâ”‚      â”‚SafetyFilterâ”‚        â”‚  â”‚
    â”‚  â”‚  â”‚  (rag.py)  â”‚      â”‚(prompt.py) â”‚      â”‚(safety.py) â”‚        â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                   â”‚                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â–¼                   â–¼                   â–¼   DATA LAYER     â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚  â”‚    FAISS       â”‚  â”‚   OpenAI API   â”‚  â”‚   Regex        â”‚         â”‚
    â”‚  â”‚  Vector Index  â”‚  â”‚  (GPT-3.5)     â”‚  â”‚   Patterns     â”‚         â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
    â”‚           â”‚                                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚  â”‚                     MongoDB                             â”‚         â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚         â”‚
    â”‚  â”‚    â”‚   documents     â”‚    â”‚    patients     â”‚          â”‚         â”‚
    â”‚  â”‚    â”‚   collection    â”‚    â”‚   collection    â”‚          â”‚         â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚         â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
    â”‚                                                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
    â”‚  â”‚              File System (Knowledge Base)                â”‚         â”‚
    â”‚  â”‚   data/demo_hospital/                                   â”‚         â”‚
    â”‚  â”‚   â”œâ”€â”€ diseases/     (hypertension.txt, diabetes.txt)   â”‚         â”‚
    â”‚  â”‚   â”œâ”€â”€ templates/    (medical_certificate_template.txt) â”‚         â”‚
    â”‚  â”‚   â”œâ”€â”€ guidelines/   (patient_education_guidelines.txt) â”‚         â”‚
    â”‚  â”‚   â”œâ”€â”€ wellness/     (preventive_health.txt)            â”‚         â”‚
    â”‚  â”‚   â””â”€â”€ disclaimers.txt                                  â”‚         â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      RAG PIPELINE ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              USER QUERY
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        QUERY PROCESSING                              â”‚
    â”‚                                                                      â”‚
    â”‚   "Generate hypertension overview for patient education"            â”‚
    â”‚                                                                      â”‚
    â”‚   Extracted: document_type = "disease_overview"                      â”‚
    â”‚              disease_name  = "hypertension"                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    CATEGORY SCOPING                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚  document_type â†’ allowed_categories                          â”‚   â”‚
    â”‚  â”‚                                                               â”‚   â”‚
    â”‚  â”‚  disease_overview    â†’ [disease]                             â”‚   â”‚
    â”‚  â”‚  medical_certificate â†’ [template, disclaimer]                â”‚   â”‚
    â”‚  â”‚  health_suggestions  â†’ [wellness, guideline, disclaimer]     â”‚   â”‚
    â”‚  â”‚  educational_notes   â†’ [wellness, guideline, disclaimer]     â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     CHUNK FILTERING                                  â”‚
    â”‚                                                                      â”‚
    â”‚    ALL CHUNKS (45)                                                  â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚    â”‚ â— disease:hypertension (12)  â—„â”€â”€ INCLUDED                  â”‚  â”‚
    â”‚    â”‚ â—‹ disease:diabetes (10)      â—„â”€â”€ EXCLUDED (wrong disease)  â”‚  â”‚
    â”‚    â”‚ â—‹ disease:respiratory (8)    â—„â”€â”€ EXCLUDED (wrong disease)  â”‚  â”‚
    â”‚    â”‚ â—‹ template (5)               â—„â”€â”€ EXCLUDED (wrong category) â”‚  â”‚
    â”‚    â”‚ â—‹ guideline (6)              â—„â”€â”€ EXCLUDED (wrong category) â”‚  â”‚
    â”‚    â”‚ â—‹ wellness (3)               â—„â”€â”€ EXCLUDED (wrong category) â”‚  â”‚
    â”‚    â”‚ â—‹ disclaimer (1)             â—„â”€â”€ EXCLUDED (wrong category) â”‚  â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                      â”‚
    â”‚    FILTERED CHUNKS: 12 hypertension-specific chunks                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   SEMANTIC SEARCH (FAISS)                           â”‚
    â”‚                                                                      â”‚
    â”‚    Query: "Generate hypertension overview for patient education"    â”‚
    â”‚                          â”‚                                          â”‚
    â”‚                          â–¼                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚     Sentence Transformer (all-MiniLM-L6-v2)             â”‚     â”‚
    â”‚    â”‚                      â”‚                                   â”‚     â”‚
    â”‚    â”‚                      â–¼                                   â”‚     â”‚
    â”‚    â”‚     Query Embedding: [0.12, -0.34, 0.56, ...]           â”‚     â”‚
    â”‚    â”‚     Dimension: 384                                       â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                          â”‚                                          â”‚
    â”‚                          â–¼                                          â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚     FAISS IndexFlatIP (Cosine Similarity)               â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚     Chunk #7:  "Hypertension is high blood..."  â†’ 0.89  â”‚     â”‚
    â”‚    â”‚     Chunk #3:  "Risk factors include obesity..." â†’ 0.84  â”‚     â”‚
    â”‚    â”‚     Chunk #11: "Symptoms may include headache..." â†’ 0.81 â”‚     â”‚
    â”‚    â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚     â”‚
    â”‚    â”‚     Chunk #2:  "Regular monitoring helps..." â†’ 0.72      â”‚     â”‚
    â”‚    â”‚     ... (remaining chunks)                               â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                          â”‚                                          â”‚
    â”‚                          â–¼                                          â”‚
    â”‚    TOP-K RESULTS (k=3): Chunks #7, #3, #11                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   PROMPT CONSTRUCTION                                â”‚
    â”‚                                                                      â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚  SYSTEM PROMPT:                                          â”‚     â”‚
    â”‚    â”‚  "You are a Healthcare GenAI RAG system.                 â”‚     â”‚
    â”‚    â”‚   Generate content ONLY from references.                 â”‚     â”‚
    â”‚    â”‚   DO NOT use general AI knowledge."                      â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚  REFERENCES:                                             â”‚     â”‚
    â”‚    â”‚  [Ref 1]: "Hypertension is high blood..."               â”‚     â”‚
    â”‚    â”‚  [Ref 2]: "Risk factors include obesity..."              â”‚     â”‚
    â”‚    â”‚  [Ref 3]: "Symptoms may include headache..."             â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚  OUTPUT STRUCTURE:                                       â”‚     â”‚
    â”‚    â”‚  # Hypertension Overview                                 â”‚     â”‚
    â”‚    â”‚  ## What is Hypertension                                 â”‚     â”‚
    â”‚    â”‚  ## Hypertension Risk Factors                            â”‚     â”‚
    â”‚    â”‚  ## Signs and Symptoms of Hypertension                   â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   LLM GENERATION (OpenAI)                           â”‚
    â”‚                                                                      â”‚
    â”‚    Model: gpt-3.5-turbo                                             â”‚
    â”‚    Temperature: 0.3 (low for factual accuracy)                      â”‚
    â”‚    Max Tokens: 1500                                                 â”‚
    â”‚                                                                      â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚  # Hypertension Overview                                 â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚  ## What is Hypertension                                 â”‚     â”‚
    â”‚    â”‚  Hypertension, commonly known as high blood pressure,    â”‚     â”‚
    â”‚    â”‚  is a condition where blood flows through arteries...    â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚  ## Hypertension Risk Factors                            â”‚     â”‚
    â”‚    â”‚  Several factors may increase your risk including:       â”‚     â”‚
    â”‚    â”‚  - Obesity and overweight                                â”‚     â”‚
    â”‚    â”‚  - Sedentary lifestyle...                                â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    SAFETY FILTERING                                  â”‚
    â”‚                                                                      â”‚
    â”‚    INPUT TEXT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
    â”‚                                                                      â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚    â”‚  Diagnosis  â”‚  â”‚ Medication  â”‚  â”‚  Fitness    â”‚  â”‚ Absolute â”‚  â”‚
    â”‚    â”‚   Filter    â”‚  â”‚   Filter    â”‚  â”‚   Filter    â”‚  â”‚  Filter  â”‚  â”‚
    â”‚    â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚          â”‚  â”‚
    â”‚    â”‚ "diagnosed  â”‚  â”‚ "50mg daily"â”‚  â”‚ "fit for    â”‚  â”‚ "will    â”‚  â”‚
    â”‚    â”‚  with" âœ—    â”‚  â”‚  â†’ REMOVED  â”‚  â”‚  work" âœ—    â”‚  â”‚  cure" âœ— â”‚  â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚           â”‚                â”‚                â”‚              â”‚        â”‚
    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â”‚                                      â”‚                              â”‚
    â”‚                                      â–¼                              â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
    â”‚    â”‚               DISCLAIMER APPENDER                        â”‚     â”‚
    â”‚    â”‚                                                          â”‚     â”‚
    â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚     â”‚
    â”‚    â”‚  ğŸ“‹ HEALTHCARE DISCLAIMER                                â”‚     â”‚
    â”‚    â”‚  This is NOT a substitute for professional advice...    â”‚     â”‚
    â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚     â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
    â”‚                                      â”‚                              â”‚
    â”‚    â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FILTERED TEXT                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    PERSISTENCE & RESPONSE                           â”‚
    â”‚                                                                      â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
    â”‚    â”‚                    MongoDB                         â”‚           â”‚
    â”‚    â”‚                                                    â”‚           â”‚
    â”‚    â”‚    documentId: "550e8400-e29b-41d4-a716-446655"   â”‚           â”‚
    â”‚    â”‚    documentType: "disease_overview"               â”‚           â”‚
    â”‚    â”‚    topic: "hypertension overview"                 â”‚           â”‚
    â”‚    â”‚    diseaseName: "hypertension"                    â”‚           â”‚
    â”‚    â”‚    generatedText: "[Filtered content]"            â”‚           â”‚
    â”‚    â”‚    createdAt: 2026-02-16T10:30:00Z               â”‚           â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
    â”‚                                                                      â”‚
    â”‚    RESPONSE:                                                         â”‚
    â”‚    {                                                                 â”‚
    â”‚      "document_id": "550e8400-e29b-41d4-a716-446655",              â”‚
    â”‚      "content": "[Generated Healthcare Content]",                   â”‚
    â”‚      "document_type": "disease_overview",                           â”‚
    â”‚      "message": "Document generated successfully"                   â”‚
    â”‚    }                                                                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ENTITY-RELATIONSHIP DIAGRAM (ERD)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                      â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚    â”‚     HOSPITAL      â”‚         â”‚      PATIENT      â”‚              â”‚
    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
    â”‚    â”‚ PK hospitalId     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ FK hospitalId     â”‚              â”‚
    â”‚    â”‚    name           â”‚   1:N   â”‚ PK patientId      â”‚              â”‚
    â”‚    â”‚    createdAt      â”‚         â”‚    name           â”‚              â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    createdAt      â”‚              â”‚
    â”‚              â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â”‚              â”‚                              â”‚                        â”‚
    â”‚              â”‚ 1:N                          â”‚ 0..1:N                 â”‚
    â”‚              â”‚                              â”‚ (optional)             â”‚
    â”‚              â–¼                              â–¼                        â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
    â”‚    â”‚      CHUNK        â”‚         â”‚     DOCUMENT      â”‚              â”‚
    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
    â”‚    â”‚ PK chunk_index    â”‚         â”‚ PK documentId     â”‚              â”‚
    â”‚    â”‚ FK hospital_id    â”‚         â”‚ FK hospitalId     â”‚              â”‚
    â”‚    â”‚    text           â”‚    N:1  â”‚ FK patientId      â”‚              â”‚
    â”‚    â”‚    category       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚    documentType   â”‚              â”‚
    â”‚    â”‚    disease        â”‚ (used   â”‚    topic          â”‚              â”‚
    â”‚    â”‚    source_file    â”‚  for    â”‚    diseaseName    â”‚              â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ retrieval)  generatedText   â”‚              â”‚
    â”‚                                  â”‚    createdAt      â”‚              â”‚
    â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    CARDINALITY LEGEND:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    1:N  = One-to-Many        PK = Primary Key
    N:1  = Many-to-One        FK = Foreign Key
    0..1 = Zero or One


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENT DEPENDENCY DIAGRAM                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                      â”‚
    â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚           â”‚              main.py                    â”‚               â”‚
    â”‚           â”‚         (FastAPI Application)          â”‚               â”‚
    â”‚           â”‚                                         â”‚               â”‚
    â”‚           â”‚   â€¢ Route handlers                      â”‚               â”‚
    â”‚           â”‚   â€¢ Request validation                  â”‚               â”‚
    â”‚           â”‚   â€¢ Response formatting                 â”‚               â”‚
    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚                            â”‚                                        â”‚
    â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
    â”‚           â”‚                â”‚                â”‚                       â”‚
    â”‚           â–¼                â–¼                â–¼                       â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
    â”‚  â”‚   rag.py    â”‚  â”‚prompt_engineâ”‚  â”‚  safety.py  â”‚                 â”‚
    â”‚  â”‚             â”‚  â”‚    .py      â”‚  â”‚             â”‚                 â”‚
    â”‚  â”‚ â€¢ RAGEngine â”‚  â”‚             â”‚  â”‚ â€¢ Safety    â”‚                 â”‚
    â”‚  â”‚ â€¢ Chunk     â”‚  â”‚ â€¢ Prompt    â”‚  â”‚   Filter    â”‚                 â”‚
    â”‚  â”‚ â€¢ FAISS ops â”‚  â”‚   Engine    â”‚  â”‚ â€¢ Regex     â”‚                 â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚   patterns  â”‚                 â”‚
    â”‚         â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
    â”‚         â”‚                â”‚                                          â”‚
    â”‚         â–¼                â–¼                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
    â”‚  â”‚ Sentence    â”‚  â”‚   OpenAI    â”‚                                  â”‚
    â”‚  â”‚ Transformer â”‚  â”‚   API       â”‚                                  â”‚
    â”‚  â”‚             â”‚  â”‚             â”‚                                  â”‚
    â”‚  â”‚ (External)  â”‚  â”‚ (External)  â”‚                                  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
    â”‚                                                                      â”‚
    â”‚         â”‚                                                           â”‚
    â”‚         â–¼                                                           â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
    â”‚  â”‚ schemas.py  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ Used by all modules                      â”‚
    â”‚  â”‚             â”‚                                                    â”‚
    â”‚  â”‚ â€¢ Pydantic  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
    â”‚  â”‚   Models    â”‚          â”‚   MongoDB   â”‚                          â”‚
    â”‚  â”‚ â€¢ Enums     â”‚          â”‚  (External) â”‚â—„â”€â”€â”€â”€ main.py             â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA FLOW DIAGRAM (DFD) - LEVEL 1                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚     USER         â”‚
                   â”‚   (External)     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
              â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  D1: Generate   â”‚         â”‚  D2: Retrieve   â”‚
    â”‚    Document     â”‚         â”‚    Document     â”‚
    â”‚     Request     â”‚         â”‚     Request     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚   P1: Validate  â”‚                  â”‚
    â”‚     Request     â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                           â”‚
             â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚   P2: RAG       â”‚                  â”‚
    â”‚   Retrieval     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ [Knowledge Base]
    â”‚                 â”‚                  â”‚     (FAISS + Files)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                           â”‚
             â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚  P3: Prompt     â”‚                  â”‚
    â”‚  Construction   â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                           â”‚
             â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚  P4: LLM        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€ [OpenAI API]
    â”‚  Generation     â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                           â”‚
             â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â”‚  P5: Safety     â”‚                  â”‚
    â”‚  Filtering      â”‚                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
             â”‚                           â”‚
             â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          P6: Database Operations        â”‚
    â”‚                                         â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚    â”‚         MongoDB                â”‚   â”‚
    â”‚    â”‚   [documents] [patients]       â”‚   â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   D3: Response   â”‚
              â”‚   (JSON)         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UML CLASS DIAGRAM (DETAILED)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                        <<dataclass>>                          â”‚  â”‚
    â”‚  â”‚                           Chunk                               â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ - text: str                                                   â”‚  â”‚
    â”‚  â”‚ - category: str  {disease|template|guideline|wellness|        â”‚  â”‚
    â”‚  â”‚                   disclaimer}                                 â”‚  â”‚
    â”‚  â”‚ - disease: Optional[str]                                      â”‚  â”‚
    â”‚  â”‚ - hospital_id: str                                            â”‚  â”‚
    â”‚  â”‚ - source_file: str                                            â”‚  â”‚
    â”‚  â”‚ - chunk_index: int                                            â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                    â–³                                â”‚
    â”‚                                    â”‚ uses                           â”‚
    â”‚                                    â”‚                                â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                         RAGEngine                             â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ + CATEGORY_DISEASE: str = "disease"                           â”‚  â”‚
    â”‚  â”‚ + CATEGORY_TEMPLATE: str = "template"                         â”‚  â”‚
    â”‚  â”‚ + CATEGORY_GUIDELINE: str = "guideline"                       â”‚  â”‚
    â”‚  â”‚ + CATEGORY_WELLNESS: str = "wellness"                         â”‚  â”‚
    â”‚  â”‚ + CATEGORY_DISCLAIMER: str = "disclaimer"                     â”‚  â”‚
    â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â”‚
    â”‚  â”‚ - model_name: str                                             â”‚  â”‚
    â”‚  â”‚ - chunk_size: int = 250                                       â”‚  â”‚
    â”‚  â”‚ - top_k: int = 3                                              â”‚  â”‚
    â”‚  â”‚ - encoder: SentenceTransformer                                â”‚  â”‚
    â”‚  â”‚ - embedding_dim: int = 384                                    â”‚  â”‚
    â”‚  â”‚ - indexes: Dict[str, faiss.IndexFlatIP]                       â”‚  â”‚
    â”‚  â”‚ - chunks: Dict[str, List[Chunk]]                              â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ + __init__()                                                  â”‚  â”‚
    â”‚  â”‚ + retrieve(query, hospital_id, doc_type, disease, k)          â”‚  â”‚
    â”‚  â”‚           â†’ Tuple[List[str], str]                             â”‚  â”‚
    â”‚  â”‚ + rebuild_index(hospital_id): void                            â”‚  â”‚
    â”‚  â”‚ + get_available_diseases(hospital_id): List[str]              â”‚  â”‚
    â”‚  â”‚ + get_index_stats(hospital_id): Dict                          â”‚  â”‚
    â”‚  â”‚ - _initialize_indexes(): void                                 â”‚  â”‚
    â”‚  â”‚ - _build_hospital_index(hospital_id): void                    â”‚  â”‚
    â”‚  â”‚ - _load_existing_index(hospital_id, path, meta): bool         â”‚  â”‚
    â”‚  â”‚ - _process_file(path, cat, disease, hosp): List[Chunk]        â”‚  â”‚
    â”‚  â”‚ - _get_allowed_categories(doc_type): List[str]                â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                       PromptEngine                            â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ - api_key: str                                                â”‚  â”‚
    â”‚  â”‚ - api_base: str                                               â”‚  â”‚
    â”‚  â”‚ - model: str = "gpt-3.5-turbo"                               â”‚  â”‚
    â”‚  â”‚ - max_tokens: int = 1500                                      â”‚  â”‚
    â”‚  â”‚ - temperature: float = 0.3                                    â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ + __init__()                                                  â”‚  â”‚
    â”‚  â”‚ + build_prompt(doc_type, topic, refs, status, patient,        â”‚  â”‚
    â”‚  â”‚               disease) â†’ Tuple[str, bool]                     â”‚  â”‚
    â”‚  â”‚ + generate(prompt, has_data, doc_type, disease) â†’ str         â”‚  â”‚
    â”‚  â”‚ - _build_disease_overview_prompt(topic, refs, disease, has)   â”‚  â”‚
    â”‚  â”‚ - _build_medical_certificate_prompt(topic, refs, patient)     â”‚  â”‚
    â”‚  â”‚ - _build_health_suggestions_prompt(topic, refs)               â”‚  â”‚
    â”‚  â”‚ - _build_educational_notes_prompt(topic, refs)                â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                       SafetyFilter                            â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ - diagnosis_patterns: List[str]                               â”‚  â”‚
    â”‚  â”‚ - medication_patterns: List[str]                              â”‚  â”‚
    â”‚  â”‚ - fitness_patterns: List[str]                                 â”‚  â”‚
    â”‚  â”‚ - absolute_patterns: List[str]                                â”‚  â”‚
    â”‚  â”‚ - standard_disclaimer: str                                    â”‚  â”‚
    â”‚  â”‚ - mc_disclaimer: str                                          â”‚  â”‚
    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
    â”‚  â”‚ + __init__()                                                  â”‚  â”‚
    â”‚  â”‚ + filter(text, doc_type) â†’ str                                â”‚  â”‚
    â”‚  â”‚ + validate(text, doc_type) â†’ Dict                             â”‚  â”‚
    â”‚  â”‚ - _filter_medical_certificate(text) â†’ str                     â”‚  â”‚
    â”‚  â”‚ - _filter_general_content(text) â†’ str                         â”‚  â”‚
    â”‚  â”‚ - _add_qualifiers(text) â†’ str                                 â”‚  â”‚
    â”‚  â”‚ - _ensure_disclaimer(text, doc_type) â†’ str                    â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚                                                                      â”‚
    â”‚         RELATIONSHIPS:                                               â”‚
    â”‚         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
    â”‚         main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º RAGEngine      (composition)             â”‚
    â”‚         main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PromptEngine   (composition)             â”‚
    â”‚         main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SafetyFilter   (composition)             â”‚
    â”‚         RAGEngine â”€â”€â”€â”€â”€â”€â”€â–º Chunk          (aggregation)             â”‚
    â”‚         RAGEngine â”€â”€â”€â”€â”€â”€â”€â–º FAISS          (dependency)              â”‚
    â”‚         PromptEngine â”€â”€â”€â”€â–º OpenAI API     (dependency)              â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE DIAGRAM - Document Lifecycle                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  START  â”‚
                                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    REQUESTED    â”‚
                              â”‚                 â”‚
                              â”‚ User submits    â”‚
                              â”‚ generation form â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ validate()                  â”‚
                        â–¼                             â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚    VALIDATED    â”‚           â”‚     FAILED      â”‚
               â”‚                 â”‚           â”‚                 â”‚
               â”‚ Request is      â”‚           â”‚ Invalid request â”‚
               â”‚ well-formed     â”‚           â”‚ or missing      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ patient         â”‚
                        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   RETRIEVING    â”‚
               â”‚                 â”‚
               â”‚ RAG engine      â”‚
               â”‚ searching       â”‚
               â”‚ knowledge base  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                     â”‚
             â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ DATA_FOUND      â”‚   â”‚ DATA_MISSING    â”‚
    â”‚                 â”‚   â”‚                 â”‚
    â”‚ Relevant chunks â”‚   â”‚ No matching     â”‚
    â”‚ retrieved       â”‚   â”‚ chunks found    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                     â”‚
             â”‚                     â–¼
             â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚            â”‚ FALLBACK_MSG    â”‚
             â”‚            â”‚                 â”‚
             â”‚            â”‚ "Insufficient   â”‚
             â”‚            â”‚  data..."       â”‚
             â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   GENERATING    â”‚
               â”‚                 â”‚
               â”‚ LLM creating    â”‚
               â”‚ content from    â”‚
               â”‚ prompt+refs     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   FILTERING     â”‚
               â”‚                 â”‚
               â”‚ Safety filter   â”‚
               â”‚ removing        â”‚
               â”‚ unsafe content  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚    PERSISTED    â”‚
               â”‚                 â”‚
               â”‚ Saved to        â”‚
               â”‚ MongoDB with    â”‚
               â”‚ unique UUID     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   DELIVERED     â”‚
               â”‚                 â”‚
               â”‚ Response sent   â”‚
               â”‚ to user         â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   END   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPLOYMENT DIAGRAM                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                     CLIENT TIER                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                      Web Browser                              â”‚  â”‚
    â”‚  â”‚                                                               â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
    â”‚  â”‚    â”‚           React SPA (Vite Build)                  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚                                                    â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚   localhost:5173 (dev) / Static hosting (prod)   â”‚     â”‚  â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ HTTP/HTTPS
                                   â”‚ Port 8000
                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    APPLICATION TIER                                  â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                Application Server                             â”‚  â”‚
    â”‚  â”‚                                                               â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
    â”‚  â”‚    â”‚             Uvicorn ASGI Server                   â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚                                                    â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”‚           FastAPI Application               â”‚  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”‚                                              â”‚  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”‚  â”‚RAGEngine â”‚ â”‚PromptEngâ”‚ â”‚SafetyFlt â”‚    â”‚  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚     â”‚  â”‚
    â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚  â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
    â”‚  â”‚                         â”‚                 â”‚                   â”‚  â”‚
    â”‚  â”‚                         â”‚                 â”‚                   â”‚  â”‚
    â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
    â”‚  â”‚    â”‚     FAISS Index Files    â”‚   â”‚  Knowledge Base      â”‚   â”‚  â”‚
    â”‚  â”‚    â”‚                          â”‚   â”‚                      â”‚   â”‚  â”‚
    â”‚  â”‚    â”‚  indexes/                â”‚   â”‚  data/demo_hospital/ â”‚   â”‚  â”‚
    â”‚  â”‚    â”‚  â”œâ”€â”€ demo_hospital.index â”‚   â”‚  â”œâ”€â”€ diseases/       â”‚   â”‚  â”‚
    â”‚  â”‚    â”‚  â””â”€â”€ demo_hospital_meta  â”‚   â”‚  â”œâ”€â”€ templates/      â”‚   â”‚  â”‚
    â”‚  â”‚    â”‚      .json               â”‚   â”‚  â”œâ”€â”€ guidelines/     â”‚   â”‚  â”‚
    â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â””â”€â”€ wellness/       â”‚   â”‚  â”‚
    â”‚  â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                         â”‚
              â–¼                                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      DATA TIER          â”‚           â”‚    EXTERNAL SERVICES    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚     MongoDB       â”‚  â”‚           â”‚  â”‚    OpenAI API     â”‚  â”‚
    â”‚  â”‚                   â”‚  â”‚           â”‚  â”‚                   â”‚  â”‚
    â”‚  â”‚  localhost:27017  â”‚  â”‚           â”‚  â”‚  api.openai.com   â”‚  â”‚
    â”‚  â”‚                   â”‚  â”‚           â”‚  â”‚                   â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚           â”‚  â”‚  GPT-3.5-turbo    â”‚  â”‚
    â”‚  â”‚  â”‚  documents  â”‚  â”‚  â”‚           â”‚  â”‚                   â”‚  â”‚
    â”‚  â”‚  â”‚  collection â”‚  â”‚  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚           â”‚                         â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  â”‚  patients   â”‚  â”‚  â”‚           â”‚  â”‚ Sentence          â”‚  â”‚
    â”‚  â”‚  â”‚  collection â”‚  â”‚  â”‚           â”‚  â”‚ Transformers      â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚           â”‚  â”‚                   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â”‚ HuggingFace Hub   â”‚  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


================================================================================
                        1. REQUIREMENTS
================================================================================

--------------------------------------------------------------------------------
1.1 FUNCTIONAL REQUIREMENTS
--------------------------------------------------------------------------------

FR-001: Document Generation
  - The system SHALL generate four types of healthcare documents:
    * Medical Certificate (Draft)
    * Disease Overview
    * Health Suggestions
    * Educational Notes
  - Example: User requests "Hypertension overview" â†’ System generates disease-
    specific educational content using RAG

FR-002: Retrieval-Augmented Generation (RAG)
  - The system SHALL retrieve relevant context from indexed medical knowledge base
  - The system SHALL use category-based filtering for scoped retrieval
  - The system SHALL use disease-specific filtering for disease overviews
  - Example: Disease overview for "hypertension" retrieves ONLY hypertension chunks

FR-003: Multi-Tenant Hospital Support
  - The system SHALL support multiple hospitals (tenants)
  - Each hospital SHALL have isolated data and indexes
  - Example: Hospital A's patients and documents are isolated from Hospital B

FR-004: Patient Management
  - The system SHALL allow patient creation for medical certificates
  - The system SHALL validate patient existence before certificate generation
  - Patient-dependent documents SHALL require valid patient_id

FR-005: Document Retrieval
  - The system SHALL allow document retrieval by unique Document ID only
  - No retrieval by patient name, disease, or other identifiers (privacy)
  - Example: User provides UUID â†’ System returns stored document

FR-006: Safety Filtering
  - The system SHALL filter generated content for:
    * Diagnosis language removal
    * Medication/dosage pattern removal
    * Fitness/unfitness statement removal for medical certificates
    * Absolute medical claim softening
  - The system SHALL append appropriate healthcare disclaimers

FR-007: Missing Data Handling
  - When reference data is insufficient, the system SHALL:
    * NOT hallucinate or use general AI knowledge
    * Return controlled "insufficient data" message
    * Prioritize safety over completeness

--------------------------------------------------------------------------------
1.2 NON-FUNCTIONAL REQUIREMENTS
--------------------------------------------------------------------------------

NFR-001: Performance
  - Document generation response time: < 30 seconds (95th percentile)
  - Vector similarity search: < 100ms for 10,000 chunks
  - API response (non-generation): < 200ms
  - FAISS index loading: < 5 seconds per hospital

NFR-002: Scalability
  - Support 100+ concurrent users
  - Support 1M+ document chunks per hospital
  - Horizontal scaling via multiple backend instances
  - Stateless API design for load balancing

NFR-003: Security & Privacy
  - Privacy-by-design: No personal health information in generated content
  - Document access only via non-guessable UUID v4
  - CORS configuration for frontend origin restrictions
  - No logging of patient names or medical details

NFR-004: Reliability
  - System uptime: 99.9% availability target
  - Graceful degradation on LLM API failures
  - MongoDB persistence for document durability
  - Index persistence to disk for crash recovery

NFR-005: Maintainability
  - Modular architecture with separation of concerns
  - Comprehensive logging for debugging
  - Configuration via environment variables
  - Type hints and Pydantic schemas for validation

NFR-006: Medical Safety Compliance
  - No diagnostic statements in generated content
  - No prescription/dosage recommendations
  - Mandatory healthcare disclaimers on all documents
  - Draft medical certificates require clinician review

================================================================================
                              2. APIs
================================================================================

--------------------------------------------------------------------------------
2.1 REST API ENDPOINTS
--------------------------------------------------------------------------------

Base URL: http://localhost:8000/api
Content-Type: application/json

+------------------------------------------------------------------------+
| ENDPOINT                      | METHOD | PURPOSE                       |
+------------------------------------------------------------------------+
| /                             | GET    | Health check                  |
| /api/generate                 | POST   | Generate healthcare document  |
| /api/document/{document_id}   | GET    | Retrieve document by ID       |
| /api/document-types           | GET    | List available document types |
| /api/patients                 | POST   | Create new patient            |
| /api/patients/{hospital_id}   | GET    | List hospital patients        |
+------------------------------------------------------------------------+

--------------------------------------------------------------------------------
2.2 REQUEST/RESPONSE SCHEMAS
--------------------------------------------------------------------------------

[2.2.1] POST /api/generate - Generate Document

REQUEST BODY (JSON):
{
    "document_type": "disease_overview",      // Required: enum value
    "topic": "Managing high blood pressure",  // Required: 3-500 chars
    "disease_name": "hypertension",           // Optional: for disease overview
    "hospital_id": "demo_hospital",           // Optional: default provided
    "patient_id": "P001"                      // Required for medical_certificate
}

RESPONSE (200 OK):
{
    "document_id": "550e8400-e29b-41d4-a716-446655440000",
    "content": "[Generated healthcare content...]",
    "document_type": "disease_overview",
    "message": "Document generated successfully. Save your Document ID..."
}

ERROR RESPONSES:
- 400 Bad Request: Invalid document type or missing required fields
- 404 Not Found: Patient not found (for medical_certificate)
- 500 Internal Server Error: LLM generation failure

--------------------------------------------------------------------------------

[2.2.2] GET /api/document/{document_id} - Retrieve Document

PATH PARAMETER:
- document_id: UUID v4 string

RESPONSE (200 OK):
{
    "document_id": "550e8400-e29b-41d4-a716-446655440000",
    "document_type": "disease_overview",
    "topic": "Managing high blood pressure",
    "content": "[Stored document content...]",
    "created_at": "2026-02-16T10:30:00Z"
}

ERROR RESPONSES:
- 404 Not Found: Document ID does not exist

--------------------------------------------------------------------------------

[2.2.3] GET /api/document-types - List Document Types

RESPONSE (200 OK):
{
    "document_types": [
        {
            "type": "medical_certificate",
            "label": "Medical Certificate (DRAFT)",
            "requires_patient": true,
            "description": "Draft medical certificate requiring clinician review"
        },
        {
            "type": "disease_overview",
            "label": "Disease Overview",
            "requires_patient": false,
            "requires_disease": true,
            "description": "Educational overview of a specific disease"
        },
        {
            "type": "health_suggestions",
            "label": "General Health Suggestions",
            "requires_patient": false,
            "description": "General wellness and health tips"
        },
        {
            "type": "educational_notes",
            "label": "Educational Medical Notes",
            "requires_patient": false,
            "description": "Educational content for patient understanding"
        }
    ],
    "available_diseases": [
        {"id": "hypertension", "label": "Hypertension (High Blood Pressure)"},
        {"id": "diabetes", "label": "Type 2 Diabetes"},
        {"id": "respiratory_health", "label": "Respiratory Health"}
    ]
}

--------------------------------------------------------------------------------

[2.2.4] POST /api/patients - Create Patient

REQUEST BODY (JSON):
{
    "patient_id": "P001",
    "name": "John Doe",
    "hospital_id": "demo_hospital"
}

RESPONSE (201 Created):
{
    "patient_id": "P001",
    "name": "John Doe",
    "hospital_id": "demo_hospital",
    "message": "Patient created successfully"
}

ERROR RESPONSES:
- 400 Bad Request: Patient already exists or invalid data

--------------------------------------------------------------------------------

[2.2.5] GET /api/patients/{hospital_id} - List Patients

PATH PARAMETER:
- hospital_id: Hospital/tenant identifier string

RESPONSE (200 OK):
{
    "patients": [
        {"patientId": "P001", "name": "John Doe"},
        {"patientId": "P002", "name": "Jane Smith"}
    ]
}

================================================================================
                              3. ENTITIES
================================================================================

--------------------------------------------------------------------------------
3.1 CORE ENTITIES
--------------------------------------------------------------------------------

[3.1.1] Chunk (Data Class)
Description: Represents a text segment with metadata for filtered retrieval

+------------------+------------------+----------------------------------------+
| ATTRIBUTE        | TYPE             | DESCRIPTION                            |
+------------------+------------------+----------------------------------------+
| text             | str              | Content of the text chunk              |
| category         | str              | disease|template|guideline|wellness|   |
|                  |                  | disclaimer                             |
| disease          | Optional[str]    | Specific disease name (e.g.,           |
|                  |                  | "hypertension") or None                |
| hospital_id      | str              | Tenant/hospital identifier             |
| source_file      | str              | Original filename                      |
| chunk_index      | int              | Position in parent document            |
+------------------+------------------+----------------------------------------+

[3.1.2] Document (MongoDB Collection)
Description: Represents a generated healthcare document

+------------------+------------------+----------------------------------------+
| ATTRIBUTE        | TYPE             | DESCRIPTION                            |
+------------------+------------------+----------------------------------------+
| documentId       | str (UUID)       | Unique document identifier (primary)   |
| hospitalId       | str              | Hospital/tenant identifier             |
| documentType     | str (enum)       | Type of generated document             |
| topic            | str              | User-provided topic/query              |
| diseaseName      | Optional[str]    | Specific disease for disease_overview  |
| patientId        | Optional[str]    | Patient ID for medical_certificate     |
| generatedText    | str              | Final filtered content                 |
| createdAt        | datetime         | Timestamp of creation                  |
+------------------+------------------+----------------------------------------+

[3.1.3] Patient (MongoDB Collection)
Description: Represents a patient in the hospital system

+------------------+------------------+----------------------------------------+
| ATTRIBUTE        | TYPE             | DESCRIPTION                            |
+------------------+------------------+----------------------------------------+
| patientId        | str              | Unique patient identifier              |
| name             | str              | Patient full name                      |
| hospitalId       | str              | Associated hospital/tenant             |
| createdAt        | datetime         | Timestamp of registration              |
+------------------+------------------+----------------------------------------+

[3.1.4] GenerateRequest (Pydantic Model)
Description: Request schema for document generation

+------------------+------------------+----------------------------------------+
| ATTRIBUTE        | TYPE             | CONSTRAINTS                            |
+------------------+------------------+----------------------------------------+
| document_type    | DocumentType     | Required, enum value                   |
| topic            | str              | Required, 3-500 characters             |
| disease_name     | Optional[str]    | For disease_overview                   |
| hospital_id      | str              | Default: "demo_hospital"               |
| patient_id       | Optional[str]    | Required for medical_certificate       |
+------------------+------------------+----------------------------------------+

[3.1.5] GenerateResponse (Pydantic Model)
Description: Response schema for document generation

+------------------+------------------+----------------------------------------+
| ATTRIBUTE        | TYPE             | DESCRIPTION                            |
+------------------+------------------+----------------------------------------+
| document_id      | str              | UUID for document retrieval            |
| content          | str              | Generated document content             |
| document_type    | str              | Type of document generated             |
| message          | str              | Status message                         |
+------------------+------------------+----------------------------------------+

--------------------------------------------------------------------------------
3.2 ENTITY RELATIONSHIPS (UML Notation)
--------------------------------------------------------------------------------

+-------------------+          generates          +-------------------+
|      Patient      |<---------------------------|    Document       |
+-------------------+         (0..*)             +-------------------+
| - patientId: str  |                           | - documentId: str |
| - name: str       |                           | - documentType    |
| - hospitalId: str |                           | - topic: str      |
+-------------------+                           | - patientId: str  |
        |                                        +-------------------+
        | belongs_to                                     |
        | (1..1)                                        |
        v                                              |
+-------------------+                                   |
|     Hospital      |<----------------------------------+
+-------------------+      creates (0..*)
| - hospitalId: str |
| - name: str       |
+-------------------+
        |
        | has (1..*)
        v
+-------------------+
|      Chunk        |
+-------------------+
| - text: str       |
| - category: str   |
| - disease: str    |
| - hospital_id     |
| - source_file     |
+-------------------+

RELATIONSHIPS:
- Hospital (1) ----contains----> (0..*) Patients
- Hospital (1) ----owns-------> (0..*) Documents  
- Hospital (1) ----indexes----> (1..*) Chunks
- Patient (0..1) <--references-- (1) Document (for medical_certificate only)
- Chunk (1..*) --retrieves_for--> (1) Document (at generation time)

================================================================================
                           4. CLASS DIAGRAMS
================================================================================

--------------------------------------------------------------------------------
4.1 BACKEND CLASS STRUCTURE
--------------------------------------------------------------------------------

+============================================================================+
|                                RAGEngine                                    |
+============================================================================+
| CONSTANTS:                                                                  |
| - CATEGORY_DISEASE: str = "disease"                                        |
| - CATEGORY_TEMPLATE: str = "template"                                      |
| - CATEGORY_GUIDELINE: str = "guideline"                                    |
| - CATEGORY_WELLNESS: str = "wellness"                                      |
| - CATEGORY_DISCLAIMER: str = "disclaimer"                                  |
+----------------------------------------------------------------------------+
| ATTRIBUTES:                                                                 |
| - model_name: str                      # Embedding model identifier        |
| - chunk_size: int = 250                # Target words per chunk            |
| - top_k: int = 3                       # Maximum retrieval results         |
| - encoder: SentenceTransformer         # Embedding generator               |
| - embedding_dim: int                   # Vector dimension (384)            |
| - indexes: Dict[str, faiss.IndexFlatIP]  # FAISS indexes per hospital     |
| - chunks: Dict[str, List[Chunk]]       # Chunk metadata per hospital       |
+----------------------------------------------------------------------------+
| METHODS:                                                                    |
| + __init__()                           # Initialize encoder, load indexes  |
| - _initialize_indexes()                # Build indexes for all hospitals   |
| - _build_hospital_index(hospital_id)   # Build single hospital index       |
| - _load_existing_index(hospital_id, ...)  # Load from disk                 |
| - _process_file(file_path, category, disease, hospital_id) -> List[Chunk]  |
| - _print_chunk_summary(chunks)         # Debug chunk distribution          |
| - _get_allowed_categories(document_type) -> List[str]  # Category filter   |
| + retrieve(query, hospital_id, document_type, disease_name, top_k)         |
|           -> Tuple[List[str], str]     # Main retrieval method             |
| + rebuild_index(hospital_id)           # Force index rebuild               |
| + get_available_diseases(hospital_id) -> List[str]                         |
| + get_index_stats(hospital_id) -> Dict # Debug statistics                  |
+============================================================================+

+============================================================================+
|                              PromptEngine                                   |
+============================================================================+
| ATTRIBUTES:                                                                 |
| - api_key: str                         # OpenAI API key                    |
| - api_base: str                        # API base URL                      |
| - model: str                           # LLM model name                    |
| - max_tokens: int                      # Generation token limit            |
| - temperature: float                   # Sampling temperature              |
+----------------------------------------------------------------------------+
| METHODS:                                                                    |
| + __init__()                           # Load config from environment      |
| + build_prompt(document_type, topic, references, retrieval_status,         |
|                patient_id, disease_name) -> Tuple[str, bool]               |
| - _build_disease_overview_prompt(topic, references, disease_name, has_data)|
| - _build_medical_certificate_prompt(topic, references, patient_id)         |
| - _build_health_suggestions_prompt(topic, references)                      |
| - _build_educational_notes_prompt(topic, references)                       |
| + generate(prompt, has_sufficient_data, document_type, disease_name)       |
|           -> str                       # Execute LLM generation            |
+============================================================================+

+============================================================================+
|                              SafetyFilter                                   |
+============================================================================+
| ATTRIBUTES:                                                                 |
| - diagnosis_patterns: List[str]        # Regex patterns for diagnosis      |
| - medication_patterns: List[str]       # Regex patterns for medications    |
| - fitness_patterns: List[str]          # Regex for fitness/unfitness       |
| - absolute_patterns: List[str]         # Regex for absolute claims         |
| - standard_disclaimer: str             # General healthcare disclaimer     |
| - mc_disclaimer: str                   # Medical certificate disclaimer    |
+----------------------------------------------------------------------------+
| METHODS:                                                                    |
| + __init__()                           # Initialize regex patterns         |
| + filter(text, document_type) -> str   # Apply safety filters              |
| - _filter_medical_certificate(text) -> str  # MC-specific filtering        |
| - _filter_general_content(text) -> str      # General content filtering    |
| - _add_qualifiers(text) -> str         # Soften categorical statements     |
| - _ensure_disclaimer(text, document_type) -> str  # Append disclaimer      |
| + validate(text, document_type) -> Dict # Validation without modification  |
+============================================================================+

+============================================================================+
|                             Chunk (DataClass)                               |
+============================================================================+
| ATTRIBUTES:                                                                 |
| - text: str                            # Chunk content                     |
| - category: str                        # Content category                  |
| - disease: Optional[str]               # Disease name if applicable        |
| - hospital_id: str                     # Owning hospital                   |
| - source_file: str                     # Original filename                 |
| - chunk_index: int                     # Position index                    |
+============================================================================+

--------------------------------------------------------------------------------
4.2 CLASS RELATIONSHIPS
--------------------------------------------------------------------------------

                          +---------------+
                          |    FastAPI    |
                          |  Application  |
                          +-------+-------+
                                  |
                                  | uses
                                  v
    +------------+        +---------------+        +---------------+
    |  RAGEngine |<-------|  main.py      |------->| PromptEngine  |
    +------------+        |  (Endpoints)  |        +---------------+
          ^               +-------+-------+               ^
          |                       |                       |
          |                       | uses                  |
          |                       v                       |
          |               +---------------+               |
          |               | SafetyFilter  |               |
          |               +---------------+               |
          |                       |                       |
          |                       |                       |
    +-----+-----+                 |                 +-----+-----+
    |   FAISS   |                 |                 |  OpenAI   |
    |   Index   |                 |                 |    API    |
    +-----------+                 |                 +-----------+
                                  |
                          +-------v-------+
                          |   MongoDB     |
                          |  (Documents,  |
                          |   Patients)   |
                          +---------------+

RELATIONSHIP TYPES:
- Composition: FastAPI Application contains RAGEngine, PromptEngine, SafetyFilter
- Association: RAGEngine uses FAISS Index, PromptEngine uses OpenAI API
- Dependency: main.py depends on all engine classes
- Aggregation: RAGEngine aggregates Chunk objects

================================================================================
                        5. SYSTEMATIC DIAGRAMS
================================================================================

--------------------------------------------------------------------------------
5.1 SEQUENCE DIAGRAM - Document Generation Flow
--------------------------------------------------------------------------------

User           Frontend         Backend (main.py)      RAGEngine        PromptEngine       SafetyFilter        MongoDB         OpenAI
  |                |                   |                   |                  |                  |                |               |
  |---(1) Submit-->|                   |                   |                  |                  |                |               |
  |   Form Data    |                   |                   |                  |                  |                |               |
  |                |---(2) POST ------>|                   |                  |                  |                |               |
  |                |   /api/generate   |                   |                  |                  |                |               |
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(3) Validate--->|                  |                  |                |               |
  |                |                   |   Patient (if MC) |                  |                  |                |<--Query-------|
  |                |                   |                   |                  |                  |                |---Result----->|
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(4) retrieve()-->|                  |                  |                |               |
  |                |                   |   query, type,    |                  |                  |                |               |
  |                |                   |   disease_name    |                  |                  |                |               |
  |                |                   |                   |---Encode Query---|                  |                |               |
  |                |                   |                   |---FAISS Search---|                  |                |               |
  |                |                   |                   |---Filter Results-|                  |                |               |
  |                |                   |<--(5) chunks, ----|                  |                  |                |               |
  |                |                   |      status       |                  |                  |                |               |
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(6) build_prompt()---------------->|                  |                |               |
  |                |                   |   doc_type, topic, refs, disease     |                  |                |               |
  |                |                   |<--(7) prompt, has_data---------------|                  |                |               |
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(8) generate()-------------------->|                  |                |               |
  |                |                   |                   |                  |----(9) POST ---->|                |               |
  |                |                   |                   |                  |   /completions   |                |               |
  |                |                   |                   |                  |<---(10) text ----|                |               |
  |                |                   |<--(11) generated_text----------------|                  |                |               |
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(12) filter()---------------------------------------->|                |               |
  |                |                   |   text, doc_type                     |                  |                |               |
  |                |                   |<--(13) filtered_text----------------------------------------|               |               |
  |                |                   |                   |                  |                  |                |               |
  |                |                   |---(14) Save Document---------------------------------------------------->|               |
  |                |                   |<--(15) Acknowledged------------------------------------------------------|               |
  |                |                   |                   |                  |                  |                |               |
  |                |<--(16) Response---|                   |                  |                  |                |               |
  |                |   {doc_id, content}                   |                  |                  |                |               |
  |<--(17) Display-|                   |                   |                  |                  |                |               |
  |   Generated Doc|                   |                   |                  |                  |                |               |

--------------------------------------------------------------------------------
5.2 FLOWCHART - RAG Retrieval Pipeline
--------------------------------------------------------------------------------

                    +-------------------+
                    |  START: retrieve()|
                    |  query, hospital, |
                    |  doc_type, disease|
                    +--------+----------+
                             |
                             v
                    +-------------------+
                    | Check if index    |
                    | exists for        |
                    | hospital_id       |
                    +--------+----------+
                             |
              +--------------+--------------+
              | No                          | Yes
              v                             v
     +-------------------+         +-------------------+
     | Build hospital    |         | Get allowed       |
     | index from files  |         | categories for    |
     |                   |         | document_type     |
     +--------+----------+         +--------+----------+
              |                             |
              +-------------+---------------+
                            |
                            v
                    +-------------------+
                    | Pre-filter chunks |
                    | by category AND   |
                    | disease (if       |
                    | disease_overview) |
                    +--------+----------+
                             |
                             v
                    +-------------------+
                    | Any filtered      |
                    | chunks found?     |
                    +--------+----------+
                             |
              +--------------+--------------+
              | No                          | Yes
              v                             v
     +-------------------+         +-------------------+
     | Return empty list |         | Encode query      |
     | with "Insufficient|         | using Sentence    |
     | data" message     |         | Transformer       |
     +-------------------+         +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | Normalize query   |
                                   | embedding (L2)    |
                                   +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | FAISS Inner       |
                                   | Product Search    |
                                   | (top k*10)        |
                                   +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | Filter results    |
                                   | to only include   |
                                   | allowed chunks    |
                                   +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | Take top-k        |
                                   | filtered results  |
                                   +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | Extract chunk     |
                                   | texts and build   |
                                   | status message    |
                                   +--------+----------+
                                            |
                                            v
                                   +-------------------+
                                   | RETURN:           |
                                   | (chunks[], status)|
                                   +-------------------+

--------------------------------------------------------------------------------
5.3 FLOWCHART - Category-Based Retrieval Logic
--------------------------------------------------------------------------------

                    +-------------------+
                    | INPUT:            |
                    | document_type     |
                    +--------+----------+
                             |
                             v
            +----------------+----------------+
            |                |                |
            v                v                v
    +-----------+    +-----------+    +-------------+
    | disease_  |    | medical_  |    | health_     |
    | overview  |    |certificate|    | suggestions |
    |           |    |           |    | educational_|
    |           |    |           |    | notes       |
    +-----+-----+    +-----+-----+    +------+------+
          |                |                 |
          v                v                 v
    +-----------+    +-----------+    +-------------+
    | ALLOWED:  |    | ALLOWED:  |    | ALLOWED:    |
    | - disease |    | - template|    | - wellness  |
    |           |    | -disclaimer|   | - guideline |
    +-----------+    +-----------+    | - disclaimer|
          |                |          +-------------+
          |                |                 |
          v                v                 v
    +-----------+    +-----------+    +-------------+
    | ALSO      |    | FILTER:   |    | GENERAL     |
    | FILTER BY |    | Templates |    | WELLNESS    |
    | disease_  |    | Only      |    | CONTENT     |
    | name      |    |           |    |             |
    +-----------+    +-----------+    +-------------+

WHY THIS MATTERS:
- Disease overview for "hypertension" ONLY returns hypertension chunks
- Guidelines/templates NEVER pollute disease queries
- This prevents generic output problem

================================================================================
                       6. IMPLEMENTATION DETAILS
================================================================================

--------------------------------------------------------------------------------
6.1 ALGORITHMS
--------------------------------------------------------------------------------

[6.1.1] Semantic Similarity Search (FAISS Inner Product)

ALGORITHM: FAISS IndexFlatIP with L2 Normalization
COMPLEXITY: O(n*d) where n = num_chunks, d = embedding_dim (384)

RATIONALE:
- IndexFlatIP (Inner Product) with normalized vectors = Cosine Similarity
- Exact search ensures highest relevance (vs approximate indexes)
- Suitable for medical domain where accuracy > speed
- 384-dim vectors (MiniLM-L6-v2) balance quality and performance

IMPLEMENTATION:
```
1. Normalize document embeddings: faiss.normalize_L2(embeddings)
2. Build flat IP index: index = faiss.IndexFlatIP(384)
3. Add vectors: index.add(embeddings)
4. At query time:
   a. Encode query: query_emb = encoder.encode([query])
   b. Normalize: faiss.normalize_L2(query_emb)
   c. Search: distances, indices = index.search(query_emb, k)
   d. Higher distance = better match (cosine similarity)
```

[6.1.2] Sentence Embedding (Transformer-Based)

MODEL: all-MiniLM-L6-v2
COMPLEXITY: O(L^2) where L = sequence length (transformer attention)

RATIONALE:
- MiniLM-L6-v2 offers best speed/quality tradeoff for retrieval
- 384-dim embeddings are compact yet semantically rich
- Pre-trained on 1B+ sentence pairs for semantic similarity
- Suitable for healthcare terms without domain fine-tuning

IMPLEMENTATION:
```
from sentence_transformers import SentenceTransformer
encoder = SentenceTransformer('all-MiniLM-L6-v2')
embeddings = encoder.encode(texts, show_progress_bar=True)
```

[6.1.3] Text Chunking (Section-Based with Word Limit)

ALGORITHM: Section marker splitting + word count chunking
COMPLEXITY: O(n) where n = document length

RATIONALE:
- Medical documents have natural section markers ("---")
- One topic per chunk prevents cross-topic contamination
- 250 words/chunk balances context window and specificity
- Preserves document structure for better retrieval

IMPLEMENTATION:
```
1. Split by "---" section markers
2. For each section:
   - Remove metadata lines (Category:, Disease:)
   - If word_count <= 250: single chunk
   - Else: split by word count into multiple chunks
3. Each chunk inherits category and disease metadata
```

[6.1.4] Safety Pattern Matching (Regex-Based)

ALGORITHM: Regular expression substitution
COMPLEXITY: O(n*p) where n = text length, p = pattern count

RATIONALE:
- Regex provides precise pattern matching for medical terms
- Allows for variations (e.g., "diagnosed with" vs "diagnosis of")
- Case-insensitive matching catches varied capitalization
- Replacement preserves document structure

PATTERNS IMPLEMENTED:
- Diagnosis: `/\b(diagnosed with|diagnosis of|confirmed)\b/i`
- Medication: `/\b\d+\s*(mg|ml|mcg|IU)\b/i`
- Fitness: `/\b(fit for|unfit for|medically fit)\b/i`
- Absolute: `/\b(will cure|guaranteed|100%)\b/i`

--------------------------------------------------------------------------------
6.2 DATA STRUCTURES
--------------------------------------------------------------------------------

[6.2.1] FAISS IndexFlatIP (Flat Inner Product Index)

STRUCTURE: Contiguous array of float32 vectors
MEMORY: O(n*d*4 bytes) = ~80KB per 1000 chunks (384-dim)

APPROPRIATENESS:
- Flat index provides exact nearest neighbor search
- Inner product with normalized vectors = cosine similarity
- No quantization loss (important for medical accuracy)
- Persistent to disk via faiss.write_index()

OPERATIONS:
- add(vectors): O(n) - append vectors to index
- search(query, k): O(n*d) - linear scan for exact results
- write/read: O(n*d) - disk persistence

[6.2.2] Dictionary (Hash Map) for Chunk Metadata

STRUCTURE: Dict[hospital_id, List[Chunk]]
MEMORY: O(n) where n = total chunks across hospitals

APPROPRIATENESS:
- O(1) hospital lookup for tenant isolation
- List allows O(1) index-based chunk retrieval
- Metadata (category, disease) enables post-filtering
- Serializable to JSON for persistence

OPERATIONS:
- get chunks by hospital: O(1)
- filter by category: O(n) linear scan
- filter by disease: O(n) linear scan

[6.2.3] Chunk DataClass

STRUCTURE: Python dataclass with typed attributes
MEMORY: ~500 bytes per chunk (text + metadata)

APPROPRIATENESS:
- Type hints enable IDE support and validation
- asdict() for JSON serialization
- Immutable-ish design prevents corruption
- Clear semantic meaning for each field

FIELDS:
- text: str (primary content)
- category: str (scoped retrieval key)
- disease: Optional[str] (disease-specific filtering)
- hospital_id: str (tenant isolation)
- source_file: str (audit trail)
- chunk_index: int (ordering)

[6.2.4] Pydantic Models (Request/Response Schemas)

STRUCTURE: BaseModel subclass with Field definitions
MEMORY: Minimal (transient request objects)

APPROPRIATENESS:
- Automatic JSON validation and parsing
- Type coercion with clear error messages
- OpenAPI schema generation for docs
- Field constraints (min_length, max_length)

MODELS:
- GenerateRequest: Incoming generation parameters
- GenerateResponse: Generation result with document_id
- DocumentResponse: Retrieved document content
- PatientCreate/Response: Patient CRUD operations

--------------------------------------------------------------------------------
6.3 NOTABLE MODIFICATIONS
--------------------------------------------------------------------------------

[6.3.1] Category-Scoped Retrieval (Custom RAG Enhancement)

STANDARD APPROACH: Single vector search across all chunks
MODIFIED APPROACH: Pre-filter chunks by category before search

RATIONALE:
- Standard RAG returned guidelines for disease queries
- This caused generic output (e.g., "consult a doctor" vs disease facts)
- Category filtering ensures query intent matches content type

IMPLEMENTATION:
```python
# Get allowed categories based on document type
allowed_categories = self._get_allowed_categories(document_type)

# Pre-filter before FAISS search
filtered_indices = []
for idx, chunk in enumerate(all_chunks):
    if chunk.category in allowed_categories:
        filtered_indices.append(idx)

# Search k*10 in full index, then filter to allowed indices
# This maintains FAISS efficiency while enabling category scoping
```

[6.3.2] Disease-Specific Filtering (Secondary Filter)

STANDARD APPROACH: Return all disease chunks for disease_overview
MODIFIED APPROACH: Filter by exact disease_name match

RATIONALE:
- "Hypertension overview" was returning diabetes content
- Disease mixing caused inaccurate overviews
- Exact match ensures query-specific results

IMPLEMENTATION:
```python
if document_type == "disease_overview" and disease_name:
    if chunk.category == CATEGORY_DISEASE:
        if chunk.disease.lower() != disease_name.lower():
            continue  # Skip non-matching diseases
```

[6.3.3] Controlled Fallback (Safety-First Missing Data)

STANDARD APPROACH: LLM generates content using general knowledge
MODIFIED APPROACH: Return explicit "insufficient data" message

RATIONALE:
- Medical accuracy requires verifiable source data
- LLM hallucination is dangerous in healthcare
- Failing safely is preferred over speculative content

IMPLEMENTATION:
```python
if not references or len(references) == 0:
    return ([], "Insufficient disease-specific reference data available...")

# In PromptEngine
if not has_sufficient_data:
    return "Insufficient reference data is available in the medical knowledge base..."
```

[6.3.4] Multi-Pattern Safety Filtering (Regex Chain)

STANDARD APPROACH: Single content filter
MODIFIED APPROACH: Layered filtering with document-type awareness

RATIONALE:
- Medical certificates need strict diagnosis/fitness filtering
- Educational content needs softer claim qualification
- Different document types have different compliance needs

IMPLEMENTATION:
```python
if document_type == DocumentType.MEDICAL_CERTIFICATE:
    text = self._filter_medical_certificate(text)  # Strict
else:
    text = self._filter_general_content(text)  # Soften claims

text = self._ensure_disclaimer(text, document_type)  # Always add
```

================================================================================
                         7. WORKING MECHANISM
================================================================================

--------------------------------------------------------------------------------
7.1 SYSTEM ARCHITECTURE
--------------------------------------------------------------------------------

+============================================================================+
|                           SYSTEM ARCHITECTURE                               |
+============================================================================+

                                  FRONTEND
                    +--------------------------------+
                    |        React + Vite App        |
                    |  +----------+  +------------+  |
                    |  | Content  |  | Document   |  |
                    |  | Form     |  | Lookup     |  |
                    |  +----+-----+  +-----+------+  |
                    +-------|--------------|--------+
                            |              |
                            v              v
                    +--------------------------------+
                    |       API Service (Axios)      |
                    |    - generateDocument()        |
                    |    - getDocument()             |
                    |    - getDocumentTypes()        |
                    +---------------+----------------+
                                    |
                                    | HTTP/JSON
                                    v
=============================================================================
                                  BACKEND
                    +--------------------------------+
                    |   FastAPI Application (main.py)|
                    |   - /api/generate (POST)       |
                    |   - /api/document/{id} (GET)   |
                    |   - /api/patients (POST/GET)   |
                    +-------+----------+------+------+
                            |          |      |
              +-------------+          |      +-------------+
              v                        v                    v
    +------------------+    +------------------+    +------------------+
    |    RAGEngine     |    |   PromptEngine   |    |   SafetyFilter   |
    | - FAISS Index    |    | - OpenAI API     |    | - Regex Patterns |
    | - Chunk Metadata |    | - Prompt Builder |    | - Disclaimers    |
    | - Category Filter|    | - RAG Prompts    |    | - Validators     |
    +--------+---------+    +--------+---------+    +--------+---------+
             |                       |                       |
             v                       v                       v
    +------------------+    +------------------+    +------------------+
    | Sentence         |    | OpenAI GPT API   |    | Generated Text   |
    | Transformer      |    | (gpt-3.5-turbo)  |    | Sanitization     |
    +------------------+    +------------------+    +------------------+

=============================================================================
                                DATA LAYER
                    +--------------------------------+
                    |           MongoDB              |
                    |   +----------+  +----------+   |
                    |   | documents|  | patients |   |
                    |   | collection| | collection|  |
                    |   +----------+  +----------+   |
                    +--------------------------------+
                    
                    +--------------------------------+
                    |      File System (Indexes)     |
                    |   +----------+  +----------+   |
                    |   | .index   |  | _metadata|   |
                    |   | (FAISS)  |  | .json    |   |
                    |   +----------+  +----------+   |
                    +--------------------------------+

--------------------------------------------------------------------------------
7.2 COMPONENT INTERACTIONS
--------------------------------------------------------------------------------

[7.2.1] Startup Initialization

SEQUENCE:
1. FastAPI app starts (uvicorn)
2. @app.on_event("startup") triggers:
   a. MongoDB client connects (AsyncIOMotorClient)
   b. RAGEngine initializes:
      - Loads SentenceTransformer model (all-MiniLM-L6-v2)
      - Scans data/ directory for hospital folders
      - For each hospital: loads or builds FAISS index
   c. PromptEngine initializes:
      - Loads OpenAI API configuration from environment
   d. SafetyFilter initializes:
      - Compiles regex patterns for content filtering

[7.2.2] Document Generation Flow

SEQUENCE:
1. User submits form (ContentForm.jsx)
2. Frontend calls api.generateDocument()
3. POST /api/generate reaches endpoint
4. Validation:
   - Pydantic validates GenerateRequest
   - If MEDICAL_CERTIFICATE: verify patient exists in MongoDB
5. RAG Retrieval:
   - RAGEngine.retrieve() called with query, doc_type, disease_name
   - Category filtering applied (disease chunks only for disease_overview)
   - FAISS similarity search executed
   - Top-k chunks returned with status
6. Prompt Construction:
   - PromptEngine.build_prompt() creates type-specific prompt
   - References embedded in prompt with RAG instructions
   - has_sufficient_data flag set based on retrieval success
7. LLM Generation:
   - PromptEngine.generate() calls OpenAI API
   - If insufficient data: returns controlled message instead
8. Safety Filtering:
   - SafetyFilter.filter() applies regex transformations
   - Diagnosis/medication patterns removed
   - Disclaimer appended
9. Persistence:
   - Document saved to MongoDB with UUID
10. Response:
    - GenerateResponse returned with document_id and content

[7.2.3] Document Retrieval Flow

SEQUENCE:
1. User enters document ID (DocumentLookup.jsx)
2. Frontend calls api.getDocument(documentId)
3. GET /api/document/{id} reaches endpoint
4. MongoDB queried by documentId
5. If found: DocumentResponse returned
6. If not found: 404 error returned
7. Frontend displays content in OutputViewer

[7.2.4] Multi-Tenant Data Isolation

MECHANISM:
- Each hospital has separate data folder: data/{hospital_id}/
- FAISS indexes stored per hospital: indexes/{hospital_id}.index
- Chunk metadata includes hospital_id for filtering
- MongoDB queries include hospitalId filter
- API requests include hospital_id parameter (default: demo_hospital)

--------------------------------------------------------------------------------
7.3 RAG PIPELINE FLOW (DETAILED)
--------------------------------------------------------------------------------

STEP 1: QUERY RECEPTION
+---------------------------------------------------------------------------+
| Input: GenerateRequest {                                                   |
|   document_type: "disease_overview",                                       |
|   topic: "Understanding high blood pressure and its management",          |
|   disease_name: "hypertension",                                            |
|   hospital_id: "demo_hospital"                                             |
| }                                                                          |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 2: CATEGORY DETERMINATION
+---------------------------------------------------------------------------+
| document_type = "disease_overview"                                         |
| -> allowed_categories = ["disease"]                                        |
|                                                                            |
| WHY: Disease overview should ONLY search disease content                   |
|      Guidelines/templates would produce generic output                     |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 3: CHUNK PRE-FILTERING
+---------------------------------------------------------------------------+
| For each chunk in hospital index:                                          |
|   IF chunk.category NOT IN ["disease"]:                                    |
|     SKIP (removes guidelines, templates, wellness)                         |
|   IF disease_name provided AND chunk.disease != "hypertension":           |
|     SKIP (removes diabetes, respiratory content)                           |
|                                                                            |
| RESULT: Only hypertension-specific chunks remain                           |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 4: QUERY EMBEDDING
+---------------------------------------------------------------------------+
| query = "Understanding high blood pressure and its management"            |
| query_embedding = encoder.encode([query])  # Shape: (1, 384)              |
| faiss.normalize_L2(query_embedding)        # Unit vector for cosine sim   |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 5: FAISS SIMILARITY SEARCH
+---------------------------------------------------------------------------+
| distances, indices = index.search(query_embedding, k=30)                  |
|                                                                            |
| Returns ranked results by cosine similarity (Inner Product)                |
| Example:                                                                   |
|   indices[0] = [14, 12, 15, 13, 8, ...]  (chunk indices)                  |
|   distances[0] = [0.87, 0.84, 0.82, 0.79, 0.11, ...]  (similarity)       |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 6: POST-FILTER TO ALLOWED CHUNKS
+---------------------------------------------------------------------------+
| filtered_results = []                                                      |
| for (dist, idx) in zip(distances, indices):                               |
|   if idx in filtered_indices:  # Pre-computed in Step 3                   |
|     filtered_results.append((dist, idx))                                   |
|   if len(filtered_results) >= top_k:                                       |
|     break                                                                  |
|                                                                            |
| RESULT: Top 3 hypertension chunks with highest similarity                  |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 7: CHUNK TEXT EXTRACTION
+---------------------------------------------------------------------------+
| result_texts = []                                                          |
| for (_, idx) in filtered_results:                                         |
|   chunk = all_chunks[idx]                                                  |
|   result_texts.append(chunk.text)                                          |
|                                                                            |
| RESULT: 3 text strings containing hypertension-specific content            |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 8: PROMPT CONSTRUCTION
+---------------------------------------------------------------------------+
| references_text = "[Reference 1]:\n{chunk1}\n\n[Reference 2]:\n{chunk2}..." |
|                                                                            |
| prompt = """You are a Healthcare GenAI RAG system.                         |
| CRITICAL: Generate ONLY from reference materials.                          |
| DO NOT use general AI knowledge.                                           |
|                                                                            |
| REFERENCE MATERIALS:                                                       |
| {references_text}                                                          |
|                                                                            |
| Generate Hypertension Overview with these headings:                        |
| # Hypertension Overview                                                    |
| ## What is Hypertension                                                    |
| ## Hypertension Risk Factors                                               |
| ..."""                                                                     |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 9: LLM GENERATION
+---------------------------------------------------------------------------+
| OpenAI API Call:                                                           |
|   model: "gpt-3.5-turbo"                                                  |
|   temperature: 0.3 (low for factual content)                              |
|   max_tokens: 1500                                                         |
|   messages: [{"role": "user", "content": prompt}]                         |
|                                                                            |
| RESULT: Disease-specific content based ONLY on references                  |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 10: SAFETY FILTERING
+---------------------------------------------------------------------------+
| Apply regex substitutions:                                                 |
|   - "diagnosed with hypertension" -> [REMOVED - DIAGNOSIS NOT PERMITTED]   |
|   - "take 50mg daily" -> [REMOVED - MEDICATION DETAILS NOT PERMITTED]      |
|   - "will cure" -> "may help with"                                         |
|                                                                            |
| Append standard healthcare disclaimer                                      |
+---------------------------------------------------------------------------+
                                    |
                                    v
STEP 11: PERSISTENCE & RESPONSE
+---------------------------------------------------------------------------+
| Generate UUID: "550e8400-e29b-41d4-a716-446655440000"                      |
|                                                                            |
| Save to MongoDB: {                                                         |
|   documentId: "550e8400-...",                                             |
|   hospitalId: "demo_hospital",                                             |
|   documentType: "disease_overview",                                        |
|   topic: "Understanding high blood pressure...",                          |
|   diseaseName: "hypertension",                                             |
|   generatedText: "[Filtered content]",                                     |
|   createdAt: ISODate("2026-02-16T10:30:00Z")                               |
| }                                                                          |
|                                                                            |
| Return: GenerateResponse {                                                 |
|   document_id: "550e8400-...",                                            |
|   content: "[Filtered content]",                                           |
|   document_type: "disease_overview",                                       |
|   message: "Document generated successfully..."                            |
| }                                                                          |
+---------------------------------------------------------------------------+

================================================================================
                              END OF DOCUMENT
================================================================================

Document prepared for: Technical Interview / System Design Review
Project: Healthcare GenAI Content Generator (RAG-Based)
Technology Stack: FastAPI, React, FAISS, MongoDB, OpenAI API, SentenceTransformers

Key Design Strengths:
1. Privacy-first design (no PII in generated content, UUID-only retrieval)
2. Medical safety compliance (no diagnosis, medications, fitness statements)
3. Category-scoped RAG prevents generic output problem
4. Multi-tenant architecture for hospital isolation
5. Controlled fallback for missing data (no hallucination)
6. Modular architecture with clear separation of concerns

================================================================================
